#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

/* TODO: Skip 6th column of C5 chars */
#define MAX_LINE_LEN 100
#define NUM_C5_CHARS 26
#define FULL_PAGE_SIZE (2+61*61)
#define NUM_ROWS 60
#define NUM_COLS 60
#define DISPLAY_NUM_COLS 61
#define CENTER_COL 30

#define C5_DISPLAY_WIDTH 6
#define C5_WIDTH 5
#define C5_HEIGHT 5

char line[MAX_LINE_LEN];

const char clean_page[FULL_PAGE_SIZE] = "\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
\n\
------------------------------------------------------------\n\
\n";


char page[FULL_PAGE_SIZE] = "\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
............................................................\n\
\n\
------------------------------------------------------------\n\
\n";


char* large_font[NUM_C5_CHARS] = {
".***.*...*******...**...*", 
"****.*...*****.*...*****.", 
".*****...**....*.....****", 
"****.*...**...**...*****.", 
"******....***..*....*****", 
"******....***..*....*....", 
".*****....*..***...*.***.", 
"*...**...*******...**...*", 
"*****..*....*....*..*****", 
"..***...*....*.*..*..**..", 
"*...**..*.***..*..*.*...*", 
"*....*....*....*....*****", 
"*...***.***.*.**...**...*", 
"*...***..**.*.**..***...*", 
".***.*...**...**...*.***.", 
"****.*...*****.*....*....", 
".***.*...**...**..**.****", 
"****.*...*****.*..*.*...*", 
".*****.....***.....*****.", 
"******.*.*..*....*...***.", 
"*...**...**...**...*.***.", 
"*...**...*.*.*..*.*...*..", 
"*...**...**.*.***.***...*", 
"*...*.*.*...*...*.*.*...*", 
"*...*.*.*...*....*....*..", 
"*****...*...*...*...*****", 
};

void C1_print_at(int col, int row, char *text, int len) {
	if (row < NUM_ROWS) {
		if (col < 0) {
			text += -col;
			len  += col;
			col   = 0;
		}
		if (len>0) {
			int i,pos,fit = NUM_COLS - col;
			if (len < fit) fit = len;
			pos = col + row * DISPLAY_NUM_COLS;
			for (i=0;i<fit;++i)
				if (text[i]!=' ')
					page[pos + i] = text[i];
		}
	}
}

void C5_print_char_at(int col, int row, char c) {
	char *font;
	int y,rem,cols_fit,col_skip,rows_fit;
	if (col < 0) {
		col_skip = -col;
		if (col_skip>=C5_WIDTH) {
			return;
		}
	}
	else {
		col_skip = 0;
	}
	cols_fit = C5_WIDTH,
	rem = NUM_COLS - col;
	if (rem < cols_fit)
		cols_fit = rem;
	rows_fit = C5_HEIGHT;
	rem = NUM_ROWS - row;
	if (rem < rows_fit)
		rows_fit = rem;
	
	font = large_font[c - 'A'];
	for (y = 0; y < rows_fit; ++y) {
		int pos = col + (y+row) * DISPLAY_NUM_COLS;
		int x;
		for (x = col_skip; x < cols_fit; ++x) {
			if (font[x]=='*')
				page[pos+x] = '*';
		}
		font += C5_WIDTH;
	}
}

void C5_print_at(int col, int row, char *text, int len) {
	if (row < NUM_ROWS) {
		int i,ccol;
		for (i=0,ccol=col
			;i<len && ccol<NUM_COLS
			;++i,ccol+=C5_DISPLAY_WIDTH) {

			char c = text[i];
			if (c != ' ') {
				C5_print_char_at(ccol,row,c);
			}
		}
	}
}

int main() {
	char erase_page = 0;

	while (NULL != fgets(line,MAX_LINE_LEN,stdin)) {

		/*
		 * opcode
		 */
		char opcode = line[1],
			 tmpchar;

		if(opcode!='E') {
			char *terminator;
			char *text;
			char *ptr = & line[6];
			int text_len;

			if (erase_page) {
				erase_page = 0;
				memcpy(page,clean_page,sizeof(page));
			}

			/*
			 * use_large_font : 0(use C1) 1(use C5)
			 */
			char use_large_font = line[4]=='5';

			/*
			 * row (row number)
			 */
			int row = *(ptr++) - '0';
			if ( (tmpchar=*(ptr++))!=' ') {
				row = row*10 + tmpchar - '0';
				++ptr;
			}
			-- row;

		   	for(terminator = line + strlen(line) - 1;*terminator!='|';--terminator)
				;
			*terminator = '\0';
			

			switch(opcode) {
				case 'P': {
					int col = *(ptr++) - '0';
					if ( (tmpchar=*(ptr++))!=' ') {
						col = col*10 + tmpchar - '0';
						++ptr;
					}
					-- col;

					text = ++ptr;
					text_len = terminator - text;
					if (!use_large_font) {
						C1_print_at(col,row,text,text_len);
					}
					else {
						C5_print_at(col,row,text,text_len);
					}
				} break;

				case 'L':
					text = ++ptr;
					text_len = terminator - text;
					if (!use_large_font) {
						C1_print_at(0,row,text,text_len);
					}
					else {
						C5_print_at(0,row,text,text_len);
					}

					break;

				case 'R':
					text = ++ptr;
					text_len = terminator - text;
					if (!use_large_font) {
						C1_print_at(NUM_COLS-text_len,row,text,text_len);
					}
					else {
						C5_print_at(NUM_COLS-text_len*C5_DISPLAY_WIDTH,row,text,text_len);
					}
					break;

				case 'C':
					text = ++ptr;
					text_len = terminator - text;
					if (!use_large_font) {
						C1_print_at(CENTER_COL-(text_len>>1),row,text,text_len);
					}
					else {
						C5_print_at(CENTER_COL-((text_len*C5_DISPLAY_WIDTH)>>1),row,text,text_len);
					}

					break;
			}

		}
		else {
			write(1,page,sizeof(page));
			erase_page = 1;
		}
	}
	return 0;
}

